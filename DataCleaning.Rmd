---
title: "Data Cleaning and Analysis"
output:
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
    includes:
      in_header: header.html
  word_document: default
  pdf_document:
    highlight: zenburn
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
print(getwd())
library(car)
library(dplyr)
library(carData)
```


### Asignatura:

Tipología y Ciclo de vida de los datos

### Autores:


José Ramón Martínez-Carbonell Martín

Miguel Ángel Pérez García


# Exploración

```{r}
#Captura
cites <- read.csv("cites_2021_original.csv", header = TRUE)
head(cites)
summary(cites)
```

```{r}
#Detección de nulos/vacíos
#sapply(cites, function(x) sum(is.na(x))) # NA
sapply(cites, function(x) sum(x=="")) #Si es vacio
#sapply(cites, function(x) sum(x==" ")) # Si no es vacio, aunque tiene un espacio
```

# Limpieza

```{r}
#Declaramos los nuevas columnas que utilizaremos
auxNumber <- c()
auxType <- c()
#Según el si el campo de importación/exportación está vacío o no,
#vamos creando el vector según convenga
for (i in 1:nrow(cites)) {
  if(!is.na(cites$Importer.reported.quantity[i])){
    auxNumber[i] <- cites$Importer.reported.quantity[i]
    auxType[i] <- "Imported"
  }else if(!is.na(cites$Exporter.reported.quantity[i])){
    auxNumber[i] <- cites$Exporter.reported.quantity[i]
    auxType[i] <- "Exported"
  }
}
#Asignamos las nuevas columnas al dataset
cites$Exportation.type <- auxType
cites$Exportation.number <- auxNumber
```


```{r}
#Creación de boxplot para detección de outliers
boxplot(cites$Exportation.number)
boxplot.stats(cites$Exportation.number)$out
```


```{r}
#Duplicados
cites[duplicated(cites),]
dim(cites)
```



```{r}
#Eliminar duplicados
cites = unique(cites)
dim(cites)
```

```{r}
#Eliminamos las columnas que ya no nos interesan
cites$Origin <- NULL
cites$Importer.reported.quantity <- NULL
cites$Exporter.reported.quantity <- NULL
cites$Family <- NULL
cites$Order <- NULL
cites$Genus <- NULL
```



```{r}
#Añadir nivel Not applied a Unit, Class, Source and Genus
levels(cites$Unit) <- c(levels(cites$Unit), "Not applied")
levels(cites$Class) <- c(levels(cites$Class), "Not applied")
levels(cites$Source) <- c(levels(cites$Source), "Not applied")
levels(cites$Purpose) <- c(levels(cites$Purpose), "Not applied")

```


```{r}
#sustición de cadena vacía por "Not applied"
for (i in 1:nrow(cites)) {
  for(j in 1:ncol(cites)){
    if((cites[i,j]=="")){
      cites[i,j] <- "Not applied"
    }
  }
}
```



# Análisis

```{r}
#Prueba de shapiro-wilk
shapiro.test(cites$Exportation.number)
```

```{r}
install.packages("car")
```

```{r}
leveneTest(y = cites$Exportation.number, group = cites$Importer, center = "median")
```
```{r}
leveneTest(y = cites$Exportation.number, group = cites$Exportation.type, center = "median")
```

```{r}
table1 <- table(cites$Importer, cites$Taxon)
chisq.test(table1)
```

```{r}
table2 <- table(cites$Exporter, cites$Taxon)
chisq.test(table2)
```

```{r}
table2 <- table(cites$Exporter, cites$Exportation.number)
chisq.test(table2)
```


```{r}
table2 <- table(cites$Importer, cites$Exportation.number)
chisq.test(table2)
```
```{r}
model <- lm(cites$Exportation.number ~ cites$Exportation.type)
summary(model)
```


```{r}
model <- lm(cites$Exportation.number ~ cites$Term)
summary(model)
```

```{r}
model <- lm(cites$Exportation.number ~ cites$Term + cites$Purpose)
anova(model)
```